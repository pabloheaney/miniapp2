<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>神聖召喚 - 十連抽</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Lucide Icons 用於卡片圖案 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0f172a;
            background-image: radial-gradient(circle at 50% 50%, #1e293b 0%, #0f172a 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none; /* 防止手機長按選取文字 */
            -webkit-user-select: none;
        }

        /* 3D 卡片容器 */
        .scene {
            perspective: 1000px;
            cursor: pointer;
            width: 100%;
            aspect-ratio: 2/3;
        }

        /* 卡片本體 */
        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1), box-shadow 0.3s ease;
            border-radius: 12px;
        }

        /* 翻牌狀態 */
        .card.is-flipped {
            transform: rotateY(180deg);
        }

        /* 稀有度光暈效果 - 預設隱藏，Hover或按壓時顯示 */
        .card::after {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            border-radius: 14px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease, box-shadow 0.3s ease;
        }

        /* 互動效果：電腦Hover 或 手機按住 (.is-peeking) 時顯示光暈 */
        @media (hover: hover) {
            .scene:hover .card:not(.is-flipped)::after {
                opacity: 1;
            }
        }
        
        .card.is-peeking:not(.is-flipped)::after {
            opacity: 1;
        }

        /* 稀有度顏色定義 */
        /* 一般 (Common) - 白色/灰色 */
        .rarity-common .card::after {
            box-shadow: 0 0 15px 2px rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.3);
        }
        /* 互動時才改變邊框顏色 */
        @media (hover: hover) {
            .rarity-common:hover .card-back { border-color: #9ca3af; }
        }
        .rarity-common .card.is-peeking .card-back { border-color: #9ca3af; }
        
        .rarity-common .card-front { border: 2px solid #ccc; background: linear-gradient(135deg, #e0e0e0, #f3f4f6); color: #333; }

        /* 高級 (Advanced) - 藍色 */
        .rarity-advanced .card::after {
            box-shadow: 0 0 15px 3px rgba(59, 130, 246, 0.7);
            background: rgba(59, 130, 246, 0.4);
        }
        /* 互動時才改變邊框顏色 */
        @media (hover: hover) {
            .rarity-advanced:hover .card-back { border-color: #3b82f6; }
        }
        .rarity-advanced .card.is-peeking .card-back { border-color: #3b82f6; }

        .rarity-advanced .card-front { border: 2px solid #3b82f6; background: linear-gradient(135deg, #eff6ff, #bfdbfe); color: #1e40af; }

        /* 稀有 (Rare) - 紫色 */
        .rarity-rare .card::after {
            box-shadow: 0 0 20px 4px rgba(168, 85, 247, 0.8);
            background: rgba(168, 85, 247, 0.5);
        }
        /* 互動時才改變邊框顏色 */
        @media (hover: hover) {
            .rarity-rare:hover .card-back { border-color: #a855f7; }
        }
        .rarity-rare .card.is-peeking .card-back { border-color: #a855f7; }

        .rarity-rare .card-front { border: 2px solid #a855f7; background: linear-gradient(135deg, #faf5ff, #e9d5ff); color: #6b21a8; }

        /* 傳說 (Legendary) - 金色 */
        .rarity-legendary .card::after {
            box-shadow: 0 0 25px 6px rgba(234, 179, 8, 0.9);
            background: rgba(234, 179, 8, 0.6);
            animation: pulse-gold 2s infinite;
        }
        /* 互動時才改變邊框顏色 */
        @media (hover: hover) {
            .rarity-legendary:hover .card-back { border-color: #eab308; }
        }
        .rarity-legendary .card.is-peeking .card-back { border-color: #eab308; }

        .rarity-legendary .card-front { 
            border: 2px solid #eab308; 
            background: linear-gradient(135deg, #fefce8, #fef08a); 
            color: #854d0e;
            box-shadow: inset 0 0 20px rgba(234, 179, 8, 0.5);
        }

        @keyframes pulse-gold {
            0% { box-shadow: 0 0 20px 5px rgba(234, 179, 8, 0.7); }
            50% { box-shadow: 0 0 30px 10px rgba(250, 204, 21, 0.9); }
            100% { box-shadow: 0 0 20px 5px rgba(234, 179, 8, 0.7); }
        }

        /* 卡片正反面通用設定 */
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            overflow: hidden;
        }

        /* 卡背設計 */
        .card-back {
            background: #1e293b;
            background-image: 
                radial-gradient(#334155 15%, transparent 16%),
                radial-gradient(#334155 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            /* 統一的預設邊框顏色，防止劇透 */
            border: 2px solid #4b5563; 
            transition: border-color 0.3s ease;
        }
        
        .card-back-logo {
            width: 50%;
            height: 50%;
            opacity: 0.3;
            color: white;
        }

        /* 卡面設計 */
        .card-front {
            transform: rotateY(180deg);
            padding: 10px;
            text-align: center;
        }

        /* 閃光動畫 (翻開時) */
        .flash {
            animation: flash-animation 0.5s ease-out;
        }

        @keyframes flash-animation {
            0% { filter: brightness(3); scale: 1.05; }
            100% { filter: brightness(1); scale: 1; }
        }
        
        /* 粒子容器 */
        #particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
        }

        .btn-glow {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
            transition: all 0.3s ease;
        }
        .btn-glow:hover {
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.8);
            transform: translateY(-2px);
        }
        .btn-glow:active {
            transform: translateY(1px);
        }

        /* 數量文字特效 */
        .amount-text {
            font-size: 2.5rem;
            font-weight: 900;
            line-height: 1;
        }
        
        .rarity-legendary .amount-text {
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-size: 3rem;
        }

    </style>
</head>
<body class="flex flex-col items-center py-8 px-4">

    <!-- 標題區域 -->
    <header class="text-center mb-8 relative z-10">
        <h1 class="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-300 via-purple-300 to-yellow-300 mb-2 drop-shadow-lg">
            閃卡召喚
        </h1>
        <p class="text-slate-400 text-sm md:text-base">長按卡背預知稀有度，點擊或放開獲得閃卡</p>
    </header>

    <!-- 控制區 -->
    <div class="mb-8 z-10">
        <button onclick="drawCards()" class="btn-glow bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-bold py-3 px-8 rounded-full text-xl flex items-center gap-2 border border-blue-400">
            <i data-lucide="sparkles"></i>
            召喚十連抽
        </button>
    </div>

    <!-- 卡片網格區域 -->
    <div id="card-grid" class="grid grid-cols-2 md:grid-cols-5 gap-4 md:gap-6 w-full max-w-6xl z-10 pb-10">
        <!-- 卡片將由 JS 生成 -->
        <div class="text-slate-500 col-span-full text-center py-20">
            點擊「召喚十連抽」開始
        </div>
    </div>

    <!-- 粒子特效層 -->
    <canvas id="particles"></canvas>

    <script>
        // 初始化 Icons
        lucide.createIcons();

        // 稀有度設定 (包含獎勵數量)
        const rarities = [
            { 
                id: 'common', 
                name: '一般', 
                amount: 1,
                colorClass: 'rarity-common', 
                chance: 0.70, 
                color: '#9ca3af', 
                iconColor: '#374151',
                icon: 'ticket' 
            },
            { 
                id: 'advanced', 
                name: '高級', 
                amount: 5,
                colorClass: 'rarity-advanced', 
                chance: 0.25, 
                color: '#3b82f6', 
                iconColor: '#1e40af',
                icon: 'layers' 
            },
            { 
                id: 'rare', 
                name: '稀有', 
                amount: 10,
                colorClass: 'rarity-rare', 
                chance: 0.04, 
                color: '#a855f7', 
                iconColor: '#6b21a8',
                icon: 'copy' 
            },
            { 
                id: 'legendary', 
                name: '傳說', 
                amount: 100,
                colorClass: 'rarity-legendary', 
                chance: 0.01, 
                color: '#eab308', 
                iconColor: '#854d0e',
                icon: 'crown' 
            }
        ];

        // 決定稀有度
        function rollRarity() {
            const rand = Math.random();
            // 從低機率(傳說)開始檢查
            // 0.99 - 1.00 : Legendary (1%)
            // 0.95 - 0.99 : Rare (4%)
            // 0.70 - 0.95 : Advanced (25%)
            // 0 - 0.70 : Common (70%)
            
            if (rand > 0.99) return rarities[3]; // Legendary
            if (rand > 0.95) return rarities[2]; // Rare
            if (rand > 0.70) return rarities[1]; // Advanced
            return rarities[0]; // Common
        }

        // 產生卡片 HTML
        function createCardElement(index) {
            const rarity = rollRarity();
            
            // 容器
            const scene = document.createElement('div');
            scene.className = `scene opacity-0 translate-y-4 transition-all duration-500 ${rarity.colorClass}`;
            scene.style.transitionDelay = `${index * 50}ms`; // 依序出現的動畫

            // 卡片本體
            const card = document.createElement('div');
            card.className = 'card';

            // 卡背
            const back = document.createElement('div');
            back.className = 'card-back card-face';
            back.innerHTML = `<i data-lucide="sparkles" class="card-back-logo"></i>`;

            // 卡面
            const front = document.createElement('div');
            front.className = 'card-front card-face';
            
            // 卡面內容 - 改為顯示數量與閃卡
            front.innerHTML = `
                <div class="text-xs font-bold uppercase tracking-wider mb-2 opacity-70">${rarity.name}</div>
                <div class="flex-1 flex flex-col items-center justify-center">
                    <i data-lucide="${rarity.icon}" size="48" style="color: ${rarity.iconColor}; width: 48px; height: 48px; margin-bottom: 8px;"></i>
                    <div class="amount-text" style="color: ${rarity.iconColor}">${rarity.amount}</div>
                </div>
                <div class="font-bold text-lg leading-tight mt-1">張閃卡</div>
                <div class="text-[10px] mt-1 opacity-60">FLASH CARDS</div>
            `;

            card.appendChild(back);
            card.appendChild(front);
            scene.appendChild(card);

            // 綁定事件
            bindCardEvents(scene, card, rarity.id);

            return scene;
        }

        // 綁定卡片互動事件 (核心邏輯)
        function bindCardEvents(scene, card, rarityId) {
            let isFlipped = false;

            // 翻牌函式
            const flipCard = () => {
                if (isFlipped) return;
                isFlipped = true;
                card.classList.add('is-flipped');
                card.classList.remove('is-peeking'); // 翻牌後移除偷看效果
                
                // 播放音效或特效 (如果是傳說)
                if (rarityId === 'legendary') {
                    createConfetti(scene);
                }
                
                // 增加一點震動/閃光
                setTimeout(() => {
                    card.querySelector('.card-front').classList.add('flash');
                }, 150);
            };

            // 開始偷看 (顯示光暈)
            const startPeek = () => {
                if (!isFlipped) {
                    card.classList.add('is-peeking');
                }
            };

            // 結束偷看
            const endPeek = () => {
                card.classList.remove('is-peeking');
            };

            // --- 電腦端滑鼠事件 ---
            // CSS :hover 已經處理了顯示顏色，這裡主要處理點擊
            scene.addEventListener('click', flipCard);
            
            // --- 手機端觸控事件 ---
            scene.addEventListener('touchstart', (e) => {
                // 防止多指觸控問題
                if (e.touches.length > 1) return;
                
                // 手機按下時，立即顯示顏色 (偷看)
                startPeek();
            }, { passive: true });

            scene.addEventListener('touchend', (e) => {
                // 手指放開時，翻牌並移除偷看狀態
                endPeek();
                flipCard();
            });

            scene.addEventListener('touchcancel', endPeek);
        }

        // 執行抽卡
        function drawCards() {
            const grid = document.getElementById('card-grid');
            grid.innerHTML = ''; // 清空舊卡片

            // 產生 10 張卡
            for (let i = 0; i < 10; i++) {
                const cardEl = createCardElement(i);
                grid.appendChild(cardEl);
                
                // 重新渲染 icons (因為是動態插入的)
                lucide.createIcons();
                
                // 觸發進場動畫
                requestAnimationFrame(() => {
                    setTimeout(() => {
                        cardEl.classList.remove('opacity-0', 'translate-y-4');
                    }, 50);
                });
            }
        }

        // --- 簡單的粒子特效 (用於傳說卡片) ---
        function createConfetti(element) {
            const rect = element.getBoundingClientRect();
            const canvas = document.getElementById('particles');
            const ctx = canvas.getContext('2d');
            
            // 調整 Canvas 大小
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            const particleCount = 50; // 增加傳說特效粒子數

            // 粒子中心點 (卡片中心)
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: centerX,
                    y: centerY,
                    vx: (Math.random() - 0.5) * 15,
                    vy: (Math.random() - 0.5) * 15,
                    life: 1.2,
                    color: `hsl(${40 + Math.random() * 20}, 100%, 50%)` // 金色系
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let active = false;

                particles.forEach(p => {
                    if (p.life > 0) {
                        active = true;
                        p.x += p.vx;
                        p.y += p.vy;
                        p.vy += 0.3; // 重力
                        p.life -= 0.02;

                        ctx.globalAlpha = p.life;
                        ctx.fillStyle = p.color;
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });

                if (active) {
                    requestAnimationFrame(animate);
                } else {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
            }
            animate();
        }

    </script>
</body>
</html>
